
## Linux 权限管理
服务器应当合理分配权限，一般只有一个管理员，其他人为普通用户。

### 1. 基本权限
权限位：`-rw-r--r-- `,一共10位，第一位为文件类型（- 文件，d 目录，l 软链接）。后面每三位为一组，第一组代表所有者u，第二组为所属组g，第三组为其他人o。
r读，w写，x执行。

#### 基本权限修改 chmod 命令：
`chmod [选项] 模式 文件名`

例如：  
`chmod u+x readme.md` 给readme.md的所有者u加可执行权限。  
`chmod g+w,o+w readme.md` 给readme.md的所属组g和其他人o加写权限。  
`chmod u-w,g-w,o-w readme.md` 去掉readme.md的写权限。  
`chmod u=rwx,g=rw readme.md` 另一种方式，直接复制。  
`chomd a=rwx readme.md` a代表所有人。

用数字代表权限（二进制位）：r -- 4, w -- 2, x -- 1. rwxr-xr-x即755。  
`chmod 755 readme.md`   
777为最高权限，644读写权限，755可执行权限，这几个比较常用。

#### 权限的作用

r: 读取文件内容（cat, more, head, tail），可以查看目录下文件名（ls）。  
w: 对文件编辑，新增，修改文件内容（vi, echo），但不包括删除文件。写权限是指对下一级的操作，例如要有对目录的写权限，才可以删除目录下的文件。对目录可新曾，删除，剪切文件和子目录等（touch, rm, mv, cp）。  
x: 对文件的执行权限。对目录可以进入（cd）。

对文件的最高权限是执行x，对目录的最高权限是写w。对目录可以赋的权限只有0，5，7，其他（1，4，6）没有意义。

#### chown 命令
修改文件所有者 `chown user 文件名`。  
`chown user:group 文件名`可以一次修改所有者和所属组。

#### chgrp 命令
修改文件所属组 `chgrp 组名 文件名`  
Linux会在添加用户时，会默认增加和用户名相同的组名。

#### 文件默认权限 umask
`umask` 命令，结果022。可以修改mask值。

文件默认不能建立可执行文件，必须手动赋予。所以文件默认权限最大为666。默认权限和umask换算成字母后相减得到最后权限。文件最大权限666（-rw-rw-rw-），umask为022（-----w--w-），再相减为 -rw-r--r--。

目录的默认权限为777（drwxrwxrwx），umask为022（-----w--w-），换算后相减为755（drwxr-xr-x)。

### 2. 特殊权限

---

## Linux 系统管理
### 1. 进程管理
进程是一个正在运行的程序或者命令，有自己的地址空间，占用系统资源。
进程管理主要是：判断服务器健康状态，查看系统中所有进程，杀死进程。

#### 进程查看命令 ps
`ps aux` 查看系统所有进程，BSD操作系统格式。  
`ps -le` 查看系统所有进程，Linux标准命令格式。(常用ps -ef|grep "xxx")   

ps命令输出：  
USER: 哪个用户产生。  
PID: 进程ID。  
CPU: CPU占比。  
MEM: 物理内存百分比。  
VSZ: 虚拟内存大小，KB。  
RSS: 物理内存大小，KB。  
TTY: 终端，tty1-tty6为本地字符终端，tty7为本地图形终端，pts/0 - xxx是远程终端。如果是？基本为系统进程。  
TIME: 占用CPU时间。  
CMD: 进程名字。  

pstree, 显示进程树。

#### top命令
`top [选项]` 每三秒钟刷新一次，默认按CPU占用率排序，可以用上面的几行查看进程是否健康。

选项：  
-d 秒数，指定每隔几秒更新，默认3秒。
-b 使用批处理输出，一般和-n合用。  
-n 次数，指定执行top命令次数。  
`top -b -n 1 > top.log`


交互命令：  
shift+P 以CPU占用率排序。  
shift+M 以内存占用率排序。  
shift+N 以PID排序。  
q 退出。  

最上面的几行：
```
top - 11:05:32 up 462 days,  3:37, 68 users,  load average: 0.09, 0.10, 0.06
Tasks: 739 total,   1 running, 737 sleeping,   1 stopped,   0 zombie
%Cpu(s):  0.2 us,  0.1 sy,  0.0 ni, 98.7 id,  1.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem : 16267988 total, 11000276 free,  1124160 used,  4143552 buff/cache
KiB Swap:  8388604 total,  5282652 free,  3105952 used. 14630928 avail Mem 

# top - 系统时间 up 运行时间, 当前登录用户, 1分钟，5分钟，15分钟的平均负载。
# Tasks: 总进程，在运行，休眠，正在停止， 僵尸进程。
# CPU: us用户占用，sy系统占用， ni修改过优先级的用户进程占比， id空闲， wa等待输入输出进程占比，
  hi硬中断请求服务占比, si软终端服务请求占比, st（steal time）虚拟时间占比。
# 内存占用情况。
# 交换分区占比。

Buffer缓冲，加快数据写入。
Cache缓存，加快数据读取。
```

#### 杀死进程

- kill命令, 杀死单一进程  
    `kill -信号 进程号PID`  
    `kill -l` 显示信号，一共64个。  

    `kill -1 xxx` 重启。   
    `kill -9 xxx` 强制杀死。  
    `kill -15 xxx` 默认。     

- killall, 批量杀进程    
    `killall [选项][信号] 进程名`  
    例如：`killall -i -9 httpd` -i表示交互模式，系统会询问，-I表示忽略进程名字大小写。  

- pkill, 也是批量  
    `pkill [选项][信号] 进程名`  
    例如：`pkill -9 -t pts/xxx` -t表示按终端杀死。  

w命令，可以查看登录用户。

#### 



---

## Linux 服务管理
#### 系统运行级别：

0. 关机
1. 单用户模式，主要用于系统修复
2. 不完全命令模式，不含NFS服务
3. 完全命令模式，就是标准字符界面
4. 系统保留
5. 图形模式
6. 重启

`runlevel` 显示运行级别。  
`init 级别号` 改变运行级别。

#### 服务分类



---


## Linux 网络管理

### ISO/OSI七层模型
OSI,开放系统互联模型。

| Level | 数据单位 | 解释 |
| ----- | ---- | ------- |
| 应用层 | APDU | 用户接口，比如浏览器界面 |
| 表示层 | PPDU | 数据表现形式，ASCII, mp3, jpg, 压缩，加密 |
| 会话层 | SPDU | 管理会话层，比如判断是否给传输层 |
| 传输层 | TPDU | TCP/UDP可靠或不可靠传输，端口号 |
| 网络层 | 报文 | 存着IP地址，用于外网通信 |
| 数据链路层 | 帧 | 帧中存储着MAC地址，也就是网卡的物理地址，负责局域网络 | 
| 物理层 | Bit | 比特流传输，物理接口，电气特性 |

上层最接近用户。上三层给用户提供服务，没有网络也需要这三层，下四层用于数据传输。
PDU: Protocol Data Unit。

### TCP/IP四层模型

| Level | 解释 |
| ----- | ---- |
| 应用层 | 对应OSI上三层 |
| 传输层 | OSI 传输层 |
| 网际互联层 | OSI 网络层 |
| 网络接口层 | OSI 下两层 | 

### 网关
网关（Gateway）又称网间连接器，协议转换器。 