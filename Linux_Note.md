
## Linux 权限管理
    服务器应当合理分配权限，一般只有一个管理员，其他人为普通用户。

### 1. 基本权限
    权限位：`-rw-r--r-- `,一共10位，第一位为文件类型（- 文件，d 目录，l 软链接）。后面每三位为一组，第一组代表所有者u，第二组为所属组g，第三组为其他人o。
    r读，w写，x执行。

#### 基本权限修改 chmod 命令：
    `chmod [选项] 模式 文件名`

    例如：
    `chmod u+x readme.md` 给readme.md的所有者u加可执行权限。
    `chmod g+w,o+w readme.md` 给readme.md的所属组g和其他人o加写权限。
    `chmod u-w,g-w,o-w readme.md` 去掉readme.md的写权限。
    `chmod u=rwx,g=rw readme.md` 另一种方式，直接复制。
    `chomd a=rwx readme.md` a代表所有人。

    用数字代表权限（二进制位）：r -- 4, w -- 2, x -- 1. rwxr-xr-x即755。
    `chmod 755 readme.md`, 777为最高权限，644读写权限，755可执行权限，这几个比较常用。

#### 权限的作用

    r: 读取文件内容（cat, more, head, tail），可以查看目录下文件名（ls）。
    w: 对文件编辑，新增，修改文件内容（vi, echo），但不包括删除文件。写权限是指对下一级的操作，例如要有对目录的写权限，才可以删除目录下的文件。对目录可新曾，删除，剪切文件和子目录等（touch, rm, mv, cp）。
    x: 对文件的执行权限。对目录可以进入（cd）。

    对文件的最高权限是执行x，对目录的最高权限是写w。对目录可以赋的权限只有0，5，7，其他（1，4，6）没有意义。

#### chown 命令
    修改文件所有者 `chown user 文件名`。
    `chown user:group 文件名`可以一次修改所有者和所属组。

#### chgrp 命令
    修改文件所属组 `chgrp 组名 文件名`
    Linux会在添加用户时，会默认增加和用户名相同的组名。

#### 文件默认权限 umask
    `umask` 命令，结果022。可以修改mask值。

    文件默认不能建立可执行文件，必须手动赋予。所以文件默认权限最大为666。默认权限和umask换算成字母后相减得到最后权限。文件最大权限666（-rw-rw-rw-），umask为022（-----w--w-），再相减为 -rw-r--r--。

    目录的默认权限为777（drwxrwxrwx），umask为022（-----w--w-），换算后相减为755（drwxr-xr-x)。

### 2. 特殊权限
#### sudo 权限
    root把超级用户执行的命令赋予普通用户。sudo的操作对象是系统命令！

    visudo超级用户赋予权限的命令。visudo会打开/etc/sudoers文件，可以赋予普通用户命令。
    例如：`visudo` 然后键入 `user1 ALL=/sbin/shutdown -r now`。保存退出。
    
    `su`命令可以切换用户。
    然后用普通用户，`sudo -l`可以拆看可以执行的命令（被赋予的）。
    普通用户输入的命令前都要加sudo。





---

## Linux 系统管理
### 1. 进程管理
    进程是一个正在运行的程序或者命令，有自己的地址空间，占用系统资源。
    进程管理主要是：判断服务器健康状态，查看系统中所有进程，杀死进程。

#### 进程查看命令 ps
    `ps aux` 查看系统所有进程，BSD操作系统格式。
    `ps -le` 查看系统所有进程，Linux标准命令格式。(常用ps -ef|grep "xxx")

    ps命令输出：
    USER: 哪个用户产生。
    PID: 进程ID。
    CPU: CPU占比。
    MEM: 物理内存百分比。
    VSZ: 虚拟内存大小，KB。
    RSS: 物理内存大小，KB。
    TTY: 终端，tty1-tty6为本地字符终端，tty7为本地图形终端，pts/0 - xxx是远程终端。如果是？基本为系统进程。
    TIME: 占用CPU时间。
    CMD: 进程名字。

    pstree, 显示进程树。

#### top命令
    `top [选项]` 每三秒钟刷新一次，默认按CPU占用率排序，可以用上面的几行查看进程是否健康。

    选项：
    -d 秒数，指定每隔几秒更新，默认3秒。
    -b 使用批处理输出，一般和-n合用。
    -n 次数，指定执行top命令次数。
    `top -b -n 1 > top.log`

    交互命令：
    shift+P 以CPU占用率排序。
    shift+M 以内存占用率排序。
    shift+N 以PID排序。
    q 退出。

最上面的几行：
```
top - 11:05:32 up 462 days,  3:37, 68 users,  load average: 0.09, 0.10, 0.06
Tasks: 739 total,   1 running, 737 sleeping,   1 stopped,   0 zombie
%Cpu(s):  0.2 us,  0.1 sy,  0.0 ni, 98.7 id,  1.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem : 16267988 total, 11000276 free,  1124160 used,  4143552 buff/cache
KiB Swap:  8388604 total,  5282652 free,  3105952 used. 14630928 avail Mem 

# top - 系统时间 up 运行时间, 当前登录用户, 1分钟，5分钟，15分钟的平均负载。
# Tasks: 总进程，在运行，休眠，正在停止， 僵尸进程。
# CPU: us用户占用，sy系统占用， ni修改过优先级的用户进程占比， id空闲， wa等待输入输出进程占比，
  hi硬中断请求服务占比, si软终端服务请求占比, st（steal time）虚拟时间占比。
# 内存占用情况。
# 交换分区占比。

Buffer缓冲，加快数据写入。
Cache缓存，加快数据读取。
```

#### 杀死进程

- kill命令, 杀死单一进程
    `kill -信号 进程号PID`
    `kill -l` 显示信号，一共64个。

    `kill -1 xxx` 重启。
    `kill -9 xxx` 强制杀死。
    `kill -15 xxx` 默认。

- killall, 批量杀进程
    `killall [选项][信号] 进程名`。
    例如：`killall -i -9 httpd`，-i表示交互模式，系统会询问，-I表示忽略进程名字大小写。

- pkill, 也是批量
    `pkill [选项][信号] 终端`，例如：`pkill -9 -t pts/xxx` -t表示按终端杀死。

    w命令，可以查看登录用户。

#### 修改进程优先级
    cpu在同一个时钟周期只能运算一个指令。进程优先级决定每个进程的处理顺序。
    `ps -le`可以显示进程优先级，PRI(priority)和NI(nice)两位都代表优先级。
    用户只能修改NI，但系统最终生效的是PRI。`PRI = PRI + NI`。
    NI的范围是-20到19，普通用户只能修改0到19，root用户可以修改NI为负值。一般不需要用户去手动调整优先级。

    nice命令用于修改NI值，只能用户新启动的进程优先级，已经存在的不能改。
    `nice [选项] 命令`。
    举例：`nice -n -5 service httpd start`，-n表示NI值，后面跟一个进程的启动命令。

    `renice [选项] PID`用于修改已经存在进程的优先级。

### 2. 工作管理（后台管理）
    工作（jobs）是和终端绑定的，当前终端只能管理当前终端的工作，不能管理其他终端。

    有两种方法将工作放入后台。
    1. `命令 &`，可以放入后台的，必须是不用和用户交互的，比如tar命令。如果是top命令，则+&后会是暂停状态。
    2. 命令执行过程中按ctrl+z, 这表示将程序在后台暂停。

    jobs命令可以查看后台进程。`jobs -l` 可以显示PID号。方括号[xx]中是工作号，还有+表示最后一个放入后台的命令，-表示倒数第二个。
    fg命令把进程恢复到前台，`fg %工作号`。bg命令把进程再放入后台，`bg %工作号`。
    如果不加工作号，则按顺序执行(+,-在这里会变化，工作号不会)。

    如果终端关掉，所有该终端的后台进程也会关闭。使进程与终端不绑定的方法：
    1. 放入/etc/rc.local文件。系统启动时调用，不与终端绑定。
    2. 使用系统定时任务。
    3. 使用nohup命令。`nohup 命令 &`。终端关闭，进程仍然存在。

### 3. 拆看系统资源
    vmstat ??
    free ??

### 4. 系统定时任务
 
    at
    crontab

    daemo守护进程




---

## Linux 服务管理
#### 系统运行级别：

    0. 关机
    1. 单用户模式，主要用于系统修复
    2. 不完全命令模式，不含NFS服务
    3. 完全命令模式，就是标准字符界面
    4. 系统保留
    5. 图形模式
    6. 重启

    `runlevel` 显示运行级别。
    `init 级别号` 改变运行级别。

#### 服务分类



---

## Linux 网络管理
### 1.基础
#### ISO/OSI七层模型
    OSI,开放系统互联模型。

| Level | 数据单位 | 解释 |
| ----- | ---- | ------- |
| 应用层 | APDU | 用户接口，比如浏览器界面 |
| 表示层 | PPDU | 数据表现形式，ASCII, mp3, jpg, 压缩，加密 |
| 会话层 | SPDU | 管理会话层，比如判断是否给传输层 |
| 传输层 | TPDU | TCP/UDP可靠或不可靠传输，端口号 |
| 网络层 | 报文 | 存着IP地址，用于外网通信 |
| 数据链路层 | 帧 | 帧中存储着MAC地址，也就是网卡的物理地址，负责局域网络 | 
| 物理层 | Bit | 比特流传输，物理接口，电气特性 |

    上层最接近用户。上三层给用户提供服务，没有网络也需要这三层，下四层用于数据传输。
    PDU: Protocol Data Unit。

#### TCP/IP四层模型

| Level | 解释 |
| ----- | ---- |
| 应用层 | 对应OSI上三层 FTP, Telnet, DNS, SMTP|
| 传输层 | OSI 传输层 TCP, UDP|
| 网际互联层 | OSI 网络层 IP协议，IGMP，ICMP互联网控制报文协议(ping)|
| 网络接口层 | OSI 下两层 ARP地址解析协议工作这层| 

#### IP地址与子网掩码

| 类别 | 最大网络数 | IP地址范围 | 最大主机数 | 私有IP地址 |
| --- | --------- | --------- | -------- | ---------- |
| A类 | 126（2^7-2）| 1.0.0.0 -- 126.255.255.255 | 2^24-2 | 10.0.0.0 -- 10.255.255.255 |
| B类 | 2^14 | 128.0.0.0 -- 191.255.255.255 | 2^16-2 | 172.16.0.0 -- 172.31.255.255 |
| C类 | 2^21 | 192.0.0.0 -- 223.255.255.255 | 2^8-2 | 192.168.0.0 -- 192.168.255.255 |

    A类最大网络数减2是因为0.0.0.0 不用，而127.0.0.0表示本地IP。
    公网IP需要付费。但私有IP地址表示免费使用，可以做内网IP，比如学校，办公室等大量使用，可以保护公网IP。
    但私有IP不可以直接访问公网。私有IP数都减2是因为第一个地址为网络地址，最后一个为广播地址。

    路由器是跨网络通信，同一个网络使用交换机通信。

    子网掩码（subnet mask）
    255.0.0.0, 255.255.0.0, 255.255.255.0分别是三类（A, B, C）标准子网掩码。
    IP和子网掩码要一起查看。子网掩码255对应IP的公网段，0对应的私有IP，同一个网段中的主机。

#### 端口号
    用于区分具体服务。
    FTP文件传输协议：20，21
    SSH安全shell协议：22
    telnet远程登录协议：23（不安全，基本已经禁止）
    DNS域名系统：53
    http超文本传输协议：80 （https: 443）
    SMTP简单邮件传输协议：25
    POP3邮局协议3代：110

    `netstat`命令。
    -a 查看所有连接和端口。
    -n 显示IP和端口号，不显示域名和服务器。

#### DNS
    Domain Name System域名解析。早期用hosts文件进行ip和域名的对应，但是维护困难。

    域名空间：
    域名中的点（.）用于分级管理，域名服务器也是分层结构。
    主机名（www）.二级域（ibm, microsoft....）.顶级域（com/org/cn/jp）。域名都是全球唯一的。

#### 网关
    网关（Gateway）又称网间连接器，协议转换器。
    1. 内网计算机访问的不是本网段数据时，就要使用。
    2. 网关负责内网IP和公网IP的互转。

    网关是服务器或路由器。
    一个局域网可以用交换机传递数据，交换机属于数据链路层，所以不认识IP（网络层），交换机认识MAC地址。
    路由器是不同网段之间进行数据交换的。这个路由器就是网关。也可以用服务器搭建网关功能，所以网关也可以是服务器。

### 2.网络配置

### 3.网络命令

### 4.远程登录
#### SSH
    对称加密算法，一个秘钥可以同时用作信息加密和解密，也叫单秘钥加密。
    非对称加密算法，有两个秘钥，公开和私有（public key and private key）。
    想象一个房间有两扇门，一个是管理员的公钥和密码加密，另一个是用户的公钥和密码，这样两人都能开门，但彼此不知道密码，比对称加密更安全。

    SSH即Secure Shell，用的是非对称加密策略。

    ssh命令：
    ssh 用户名@ip(或主机名)。用户名可以省略，表示用当前用户登录。exit命令退出。
    第一ssh会提示下载主机的ssh公钥，存于`.ssh`目录下。

    scp命令：
    `scp [-r] 用户名@ip:文件路径 本地路径` 下载文件。
    `scp [-r] 粉底文件 用户名@ip:文件路径` 上传文件。-r表示目录。





